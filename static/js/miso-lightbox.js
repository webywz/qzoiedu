'use strict';(function($){var misoLightbox,defaults;misoLightbox=function(){function misoLightbox(element,options1){var misoLightbox;this.options=options1;this.$element=$(element);this.didInit=false;misoLightbox=this;this.$element.on('click.misoLightbox',this.options.itemSelector,function(e){var $clickedItem,$items;e.preventDefault();$clickedItem=$(this);$clickedItem.blur();if(typeof misoLightbox.options.shouldOpen==='function'){if(!misoLightbox.options.shouldOpen(misoLightbox,$clickedItem,e)){return}}$items=misoLightbox.$element.find(misoLightbox.options.itemSelector);if(misoLightbox.elementIsmiso()){$items=misoLightbox.filterOutmisoClones($items);$clickedItem=misoLightbox.handlePossibleCloneClick($clickedItem,$items)}return misoLightbox.init($items.index($clickedItem))})}misoLightbox.prototype.init=function(index){this.didInit=true;this.detectIE();this.createModal();this.bindEvents();this.initmiso(index);return this.open()};misoLightbox.prototype.createModalItems=function(){var $items,createItem,itemTemplate,lazyPlaceholder,length,links;lazyPlaceholder=this.options.lazyPlaceholder||'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';itemTemplate=function(source,caption,lazy){var imgSourceParams;if(lazy===true){imgSourceParams=' data-lazy="'+source+'" src="'+lazyPlaceholder+'" '}else{imgSourceParams=' src="'+source+'" '}return'<div class="miso-lightbox-miso-item">\n  <div class="miso-lightbox-miso-item-inner">\n    <img class="miso-lightbox-miso-img" '+imgSourceParams+' />\n    '+caption+'\n  </div>\n</div>'};if(this.options.images){links=$.map(this.options.images,function(_this){return function(img){return itemTemplate(img,_this.options.lazy)}}(this))}else{$items=this.filterOutmisoClones(this.$element.find(this.options.itemSelector));length=$items.length;createItem=function(_this){return function(el,index){var caption,info,src;info={index:index,length:length};caption=_this.getElementCaption(el,info);src=_this.getElementSrc(el);return itemTemplate(src,caption,_this.options.lazy)}}(this);links=$.map($items,createItem)}return links};misoLightbox.prototype.createModal=function(){var html,links;links=this.createModalItems();html='<div class="miso-lightbox miso-lightbox-hide-init'+(this.isIE?' miso-lightbox-ie':'')+'" style="background: '+this.options.background+';">\n  <div class="miso-lightbox-inner">\n    <div class="miso-lightbox-miso miso-caption-'+this.options.captionPosition+'">'+links.join('')+'</div>\n  <div>\n<div>';this.$modalElement=$(html);this.$parts={};this.$parts['closeButton']=$(this.options.layouts.closeButton);this.$modalElement.find('.miso-lightbox-inner').append(this.$parts['closeButton']);return $('body').append(this.$modalElement)};misoLightbox.prototype.initmiso=function(index){var additional;additional={initialSlide:index};if(this.options.lazy){additional.lazyLoad='ondemand'}if(this.options.miso!=null){if(typeof this.options.miso==='function'){this.miso=this.options.miso(this.$modalElement)}else{this.miso=this.$modalElement.find('.miso-lightbox-miso').miso($.extend({},this.options.miso,additional))}}else{this.miso=this.$modalElement.find('.miso-lightbox-miso').miso(additional)}return this.$modalElement.trigger('init.misoLightbox')};misoLightbox.prototype.open=function(){if(this.options.useHistoryApi){this.writeHistory()}this.$element.trigger('show.misoLightbox');setTimeout(function(_this){return function(){return _this.$element.trigger('shown.misoLightbox')}}(this),this.getTransitionDuration());return this.$modalElement.removeClass('miso-lightbox-hide-init')};misoLightbox.prototype.close=function(){this.$element.trigger('hide.misoLightbox');setTimeout(function(_this){return function(){return _this.$element.trigger('hidden.misoLightbox')}}(this),this.getTransitionDuration());this.$modalElement.addClass('miso-lightbox-hide');return this.destroy()};misoLightbox.prototype.bindEvents=function(){var resizeSlides;resizeSlides=function(_this){return function(){var h;h=_this.$modalElement.find('.miso-lightbox-inner').height();_this.$modalElement.find('.miso-lightbox-miso-item').height(h);return _this.$modalElement.find('.miso-lightbox-miso-img, .miso-lightbox-miso-item-inner').css('max-height',Math.round(_this.options.imageMaxHeight*h))}}(this);$(window).on('orientationchange.misoLightbox resize.misoLightbox',resizeSlides);if(this.options.useHistoryApi){$(window).on('popstate.misoLightbox',function(_this){return function(){return _this.close()}}(this))}this.$modalElement.on('init.misoLightbox',resizeSlides);this.$modalElement.on('destroy.misoLightbox',function(_this){return function(){return _this.destroy()}}(this));this.$element.on('destroy.misoLightbox',function(_this){return function(){return _this.destroy(true)}}(this));this.$parts['closeButton'].on('click.misoLightbox touchstart.misoLightbox',function(_this){return function(e){e.preventDefault();return _this.close()}}(this));if(this.options.closeOnEscape||this.options.navigateByKeyboard){$(document).on('keydown.misoLightbox',function(_this){return function(e){var code;code=e.keyCode?e.keyCode:e.which;if(_this.options.navigateByKeyboard){if(code===37){_this.slidemiso('left')}else if(code===39){_this.slidemiso('right')}}if(_this.options.closeOnEscape){if(code===27){return _this.close()}}}}(this))}if(this.options.closeOnBackdropClick){this.$modalElement.on('click.misoLightbox touchstart.misoLightbox','.miso-lightbox-miso-img',function(e){return e.stopPropagation()});return this.$modalElement.on('click.misoLightbox','.miso-lightbox-miso-item',function(_this){return function(e){e.preventDefault();return _this.close()}}(this))}};misoLightbox.prototype.slidemiso=function(direction){if(direction==='left'){return this.miso.miso('misoPrev')}else{return this.miso.miso('misoNext')}};misoLightbox.prototype.detectIE=function(){var ieversion;this.isIE=false;if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){ieversion=new Number(RegExp.$1);if(ieversion<9){return this.isIE=true}}};misoLightbox.prototype.getElementCaption=function(el,info){var c;if(!this.options.caption){return''}c=function(){switch(typeof this.options.caption){case'function':return this.options.caption(el,info);case'string':return $(el).data(this.options.caption)}}.call(this);return'<span class="miso-lightbox-miso-caption">'+c+'</span>'};misoLightbox.prototype.getElementSrc=function(el){switch(typeof this.options.src){case'function':return this.options.src(el);case'string':return $(el).attr(this.options.src);default:return el.href}};misoLightbox.prototype.unbindEvents=function(){$(window).off('.misoLightbox');$(document).off('.misoLightbox');return this.$modalElement.off('.misoLightbox')};misoLightbox.prototype.destroy=function(unbindAnchors){if(unbindAnchors==null){unbindAnchors=false}if(this.didInit){this.unbindEvents();setTimeout(function(_this){return function(){return _this.$modalElement.remove()}}(this),this.options.destroyTimeout)}if(unbindAnchors){this.$element.off('.misoLightbox');return this.$element.off('.misoLightbox',this.options.itemSelector)}};misoLightbox.prototype.destroyPrevious=function(){return $('body').children('.miso-lightbox').trigger('destroy.misoLightbox')};misoLightbox.prototype.getTransitionDuration=function(){var duration;if(this.transitionDuration){return this.transitionDuration}duration=this.$modalElement.css('transition-duration');if(typeof duration==='undefined'){return this.transitionDuration=500}else{return this.transitionDuration=duration.indexOf('ms')>-1?parseFloat(duration):parseFloat(duration)*1000}};misoLightbox.prototype.writeHistory=function(){return typeof history!=='undefined'&&history!==null?typeof history.pushState==='function'?history.pushState(null,null,''):void 0:void 0};misoLightbox.prototype.filterOutmisoClones=function($items){if(!this.elementIsmiso()){return $items}return $items=$items.filter(function(){var $item;$item=$(this);return!$item.hasClass('miso-cloned')&&$item.parents('.miso-cloned').length===0})};misoLightbox.prototype.handlePossibleCloneClick=function($clickedItem,$items){var href;if(!this.elementIsmiso()){return $clickedItem}if(!$clickedItem.closest('.miso-slide').hasClass('miso-cloned')){return $clickedItem}href=$clickedItem.attr('href');return $items.filter(function(){return $(this).attr('href')===href}).first()};misoLightbox.prototype.elementIsmiso=function(){return this.$element.hasClass('miso-slider')};return misoLightbox}();defaults={background:'rgba(0,0,0,.8)',closeOnEscape:true,closeOnBackdropClick:true,destroyTimeout:500,itemSelector:'a',navigateByKeyboard:true,src:false,caption:false,captionPosition:'dynamic',images:false,miso:{infinite:false, autoplay: false},useHistoryApi:false,layouts:{closeButton:'<button type="button" class="miso-lightbox-close"></button>'},shouldOpen:null,imageMaxHeight:0.9,lazy:false};$.fn.misoLightbox=function(options){options=$.extend({},defaults,options);$(this).each(function(){return this.misoLightbox=new misoLightbox(this,options)});return this};$.fn.unmisoLightbox=function(){return $(this).trigger('destroy.misoLightbox').each(function(){return this.misoLightbox=null})}}(jQuery));